---
import '../globals.css';
import SpeedInsights from '@vercel/speed-insights/astro';
import Header from '../components/Header_v3.astro';
import Footer from '../components/Footer.tsx';

interface Props {
	title: string;
	description?: string;
}
const { title, description } = Astro.props;
---

<!doctype html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="description" content={description} />
		<meta name="viewport" content="width=device-width" />
		<link rel="icon" type="image/svg+xml" href="/favicon.svg" />
		<link rel="icon" type="image/png" href="/favicon.png" sizes="512x512" />
		<meta name="generator" content={Astro.generator} />
		<title>{title} | Dan Glorioso</title>
	</head>
	
	<body class="min-h-screen">
		<canvas id="aviation-canvas" class="fixed top-0 left-0 w-full h-full pointer-events-none" style="background: var(--bg-primary, #0f172a);"></canvas>

		<!-- Vercel Speed Insights -->
		<SpeedInsights />

		<div class="flex flex-col gap-4">
			<!-- Header -->
			<Header />

			<!-- Header spacer to prevent content from being hidden behind fixed header -->
			<div class="h-20 sm:h-22"></div>

			<!-- Mobile Menu (slides from behind header) -->
			<div 
				id="mobile-menu" 
				class="md:hidden fixed left-0 right-0 z-40 transform -translate-y-full transition-all duration-300 ease-in-out pointer-events-none"
				aria-hidden="true"
			>
				<!-- Full Screen Backdrop -->
				<div class="fixed inset-0 bg-black/50 backdrop-blur-sm z-30" id="mobile-menu-backdrop"></div>
				
				<!-- Menu Panel that slides from behind header -->
				<div class="relative z-40 bg-slate-900 border-b border-slate-700/50 shadow-2xl pt-20">
					
					<!-- Navigation Links -->
					<nav class="px-6 py-6">
						<ul class="space-y-2" id="mobile-nav-links">
							<!-- Navigation items will be populated by JavaScript -->
						</ul>
					</nav>
				</div>
			</div>

			<!-- Page Content -->
			<main class="flex flex-col max-w-5xl px-8 md:px-16 py-8 mx-auto w-full relative z-0">
				<slot />
			</main>
		<!-- Footer -->
		<Footer />

	</div>

	<!-- Back to Top Button -->
	<button 
		id="back-to-top"
		class="fixed bottom-6 right-6 p-3 z-[100] bg-slate-850/90 hover:bg-slate-800/90 backdrop-blur-sm border border-slate-700/50 rounded-full shadow-lg transition-all duration-300 opacity-0 translate-y-2 pointer-events-none group"
		aria-label="Back to top"
	>
		<svg 
			class="w-5 h-5 mx-auto text-gray-300 group-hover:text-white transition-colors duration-200" 
			fill="none"
			stroke="currentColor"
			viewBox="0 0 24 24"
		>
			<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 10l7-7m0 0l7 7m-7-7v18"></path>
		</svg>
	</button>
	
		<script is:inline>
			// Aviation Radar Display Background
			class AviationRadar {
				constructor() {
					this.canvas = document.getElementById('aviation-canvas');
					this.ctx = this.canvas.getContext('2d');
					this.time = 0;
					this.bgColor = this.getBackgroundColor();
					this.sweepAngle = 0;
					this.flightPaths = [];
					
					this.resize();
					this.createFlightPaths();
					this.bindEvents();
					this.animate();
				}
				
				getBackgroundColor() {
					const bgColor = getComputedStyle(document.documentElement)
						.getPropertyValue('--bg-primary')
						.trim();
					return bgColor || '#0f172a';
				}
				
				getAccentColor() {
					const accentColor = getComputedStyle(document.documentElement)
						.getPropertyValue('--accent-primary')
						.trim() || 'rgb(59, 130, 246)';
					
					let r, g, b;
					if (accentColor.startsWith('oklch')) {
						r = 59; g = 130; b = 246;
					} else if (accentColor.startsWith('#')) {
						const hex = accentColor.slice(1);
						r = parseInt(hex.slice(0, 2), 16);
						g = parseInt(hex.slice(2, 4), 16);
						b = parseInt(hex.slice(4, 6), 16);
					} else if (accentColor.startsWith('rgb')) {
						const matches = accentColor.match(/\d+/g);
						r = parseInt(matches[0]);
						g = parseInt(matches[1]);
						b = parseInt(matches[2]);
					} else {
						r = 59; g = 130; b = 246;
					}
					
					return { r, g, b };
				}
				
				resize() {
					this.canvas.width = window.innerWidth;
					this.canvas.height = window.innerHeight;
					this.centerX = this.canvas.width / 2;
					this.centerY = this.canvas.height / 2;
					this.maxRadius = Math.min(this.canvas.width, this.canvas.height) * 0.6;
				}
				
				createFlightPaths() {
					this.flightPaths = [];
					const pathCount = 4;
					const accent = this.getAccentColor();
					
					for (let i = 0; i < pathCount; i++) {
						const angle = (Math.PI * 2 / pathCount) * i + Math.random() * 0.5;
						const distance = this.maxRadius * (0.3 + Math.random() * 0.4);
						const startX = this.centerX + Math.cos(angle) * distance;
						const startY = this.centerY + Math.sin(angle) * distance;
						
						this.flightPaths.push({
							startX,
							startY,
							endX: this.centerX + Math.cos(angle + Math.PI) * distance,
							endY: this.centerY + Math.sin(angle + Math.PI) * distance,
							progress: Math.random(),
							speed: 0.0003 + Math.random() * 0.0005,
							opacity: 0.15 + Math.random() * 0.1,
							color: accent,
							width: 1 + Math.random() * 0.5
						});
					}
				}
				
				bindEvents() {
					window.addEventListener('resize', () => {
						this.resize();
						this.createFlightPaths();
					});
				}
				
				drawRadarGrid() {
					const accent = this.getAccentColor();
					const opacity = 0.08;
					
					this.ctx.strokeStyle = `rgba(${accent.r}, ${accent.g}, ${accent.b}, ${opacity})`;
					this.ctx.lineWidth = 0.5;
					
					// Concentric circles (radar range rings)
					for (let i = 1; i <= 3; i++) {
						const radius = (this.maxRadius / 3) * i;
						this.ctx.beginPath();
						this.ctx.arc(this.centerX, this.centerY, radius, 0, Math.PI * 2);
						this.ctx.stroke();
					}
					
					// Radial lines (compass directions)
					for (let i = 0; i < 8; i++) {
						const angle = (Math.PI * 2 / 8) * i;
						this.ctx.beginPath();
						this.ctx.moveTo(this.centerX, this.centerY);
						this.ctx.lineTo(
							this.centerX + Math.cos(angle) * this.maxRadius,
							this.centerY + Math.sin(angle) * this.maxRadius
						);
						this.ctx.stroke();
					}
				}
				
				drawRadarSweep() {
					const accent = this.getAccentColor();
					const sweepLength = this.maxRadius;
					
					// Create gradient for sweep
					const gradient = this.ctx.createLinearGradient(
						this.centerX, this.centerY,
						this.centerX + Math.cos(this.sweepAngle) * sweepLength,
						this.centerY + Math.sin(this.sweepAngle) * sweepLength
					);
					
					gradient.addColorStop(0, `rgba(${accent.r}, ${accent.g}, ${accent.b}, 0.15)`);
					gradient.addColorStop(0.5, `rgba(${accent.r}, ${accent.g}, ${accent.b}, 0.08)`);
					gradient.addColorStop(1, `rgba(${accent.r}, ${accent.g}, ${accent.b}, 0)`);
					
					// Draw sweep arc
					this.ctx.beginPath();
					this.ctx.moveTo(this.centerX, this.centerY);
					this.ctx.arc(
						this.centerX, this.centerY,
						sweepLength,
						this.sweepAngle - 0.15,
						this.sweepAngle + 0.15
					);
					this.ctx.closePath();
					this.ctx.fillStyle = gradient;
					this.ctx.fill();
					
					// Sweep line
					this.ctx.strokeStyle = `rgba(${accent.r}, ${accent.g}, ${accent.b}, 0.3)`;
					this.ctx.lineWidth = 1;
					this.ctx.beginPath();
					this.ctx.moveTo(this.centerX, this.centerY);
					this.ctx.lineTo(
						this.centerX + Math.cos(this.sweepAngle) * sweepLength,
						this.centerY + Math.sin(this.sweepAngle) * sweepLength
					);
					this.ctx.stroke();
				}
				
				drawFlightPaths() {
					this.flightPaths.forEach(path => {
						path.progress += path.speed;
						if (path.progress > 1) path.progress = 0;
						
						const currentX = path.startX + (path.endX - path.startX) * path.progress;
						const currentY = path.startY + (path.endY - path.startY) * path.progress;
						
						// Draw path trail
						this.ctx.strokeStyle = `rgba(${path.color.r}, ${path.color.g}, ${path.color.b}, ${path.opacity * 0.3})`;
						this.ctx.lineWidth = path.width;
						this.ctx.beginPath();
						this.ctx.moveTo(path.startX, path.startY);
						this.ctx.lineTo(path.endX, path.endY);
						this.ctx.stroke();
						
						// Draw aircraft blip
						const blipSize = 3;
						this.ctx.fillStyle = `rgba(${path.color.r}, ${path.color.g}, ${path.color.b}, ${path.opacity})`;
						this.ctx.beginPath();
						this.ctx.arc(currentX, currentY, blipSize, 0, Math.PI * 2);
						this.ctx.fill();
						
						// Blip glow
						const glowGradient = this.ctx.createRadialGradient(
							currentX, currentY, 0,
							currentX, currentY, blipSize * 2
						);
						glowGradient.addColorStop(0, `rgba(${path.color.r}, ${path.color.g}, ${path.color.b}, ${path.opacity})`);
						glowGradient.addColorStop(1, `rgba(${path.color.r}, ${path.color.g}, ${path.color.b}, 0)`);
						this.ctx.fillStyle = glowGradient;
						this.ctx.beginPath();
						this.ctx.arc(currentX, currentY, blipSize * 2, 0, Math.PI * 2);
						this.ctx.fill();
					});
				}
				
				animate() {
					this.time += 16;
					this.sweepAngle += 0.008; // Slow rotation
					if (this.sweepAngle > Math.PI * 2) this.sweepAngle = 0;
					
					// Clear canvas
					this.ctx.fillStyle = this.bgColor;
					this.ctx.fillRect(0, 0, this.canvas.width, this.canvas.height);
					
					// Draw radar elements
					this.drawRadarGrid();
					this.drawRadarSweep();
					this.drawFlightPaths();
					
					requestAnimationFrame(() => this.animate());
				}
			}

			// Back to Top Button Functionality
			function initBackToTop() {
				const backToTopBtn = document.getElementById('back-to-top');
				if (!backToTopBtn) return;

				function toggleButtonVisibility() {
					const scrollTop = window.pageYOffset || document.documentElement.scrollTop;
					
					if (scrollTop > 300) {
						backToTopBtn.classList.remove('opacity-0', 'translate-y-2', 'pointer-events-none');
						backToTopBtn.classList.add('opacity-100', 'translate-y-0');
					} else {
						backToTopBtn.classList.add('opacity-0', 'translate-y-2', 'pointer-events-none');
						backToTopBtn.classList.remove('opacity-100', 'translate-y-0');
					}
				}

				function scrollToTop() {
					window.scrollTo({
						top: 0,
						behavior: 'smooth'
					});
				}

				window.addEventListener('scroll', toggleButtonVisibility);
				backToTopBtn.addEventListener('click', scrollToTop);
				toggleButtonVisibility();
			}
			
			// Initialize when DOM is loaded
			if (document.readyState === 'loading') {
				document.addEventListener('DOMContentLoaded', () => {
					new AviationRadar();
					initBackToTop();
				});
			} else {
				new AviationRadar();
				initBackToTop();
			}
		</script>
	</body>
</html>

<style is:global>
	* {
		margin: 0;
		padding: 0;
		box-sizing: border-box;
	}
	
	html, body {
		font-family: -apple-system, BlinkMacSystemFont, Inter, system-ui, sans-serif;
		overflow-x: hidden;
	}
	
	body {
		background: var(--bg-primary);
		min-height: 100vh;
	}
	
	/* Text selection highlight color */
	::selection {
		background-color: var(--accent-primary);
		color: var(--text-primary);
	}
	
	::-moz-selection {
		background-color: var(--accent-primary);
		color: var(--text-primary);
	}
</style>

