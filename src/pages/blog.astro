---
import { getCollection } from 'astro:content';
import Layout from '../layouts/Layout.astro';
import BlogCard from '../components/BlogCard.astro';

// Get all blog posts that aren't drafts and sort by date (with newest first)
const allPosts = await getCollection('blog', ({ data }) => {
	return data.draft !== true;
});

const sortedPosts = allPosts.sort((a, b) => {
	return b.data.pubDate.getTime() - a.data.pubDate.getTime();
});
---

<Layout title="Blog" description="">
	<section id="blog">
		<div class="h-full w-full flex flex-col gap-6">
			<!-- Page Header -->
			<section class="">
				<h1 class="text-4xl font-bold">
					Blog
				</h1>
			</section>

			<div class="flex flex-col gap-6">
				{sortedPosts.map((post) => (
					<a href={`/blog/${post.slug}`} class="block group">
						<BlogCard 
							title={post.data.title}
							description={post.data.description}
							pubDate={post.data.pubDate.toISOString()}
							tags={post.data.tags ?? []}
							category={post.data.category}
						/>
					</a>
				))}
			</div>

      <!-- Newsletter Signup -->
      <section class="mt-8 pt-16 border-t border-slate-700/50">
        <div class="text-center">
          <h3 class="text-3xl font-bold text-white mb-4">Subscribe to the newsletter</h3>
          <p class="text-gray-300 mb-8 max-w-md mx-auto">
            Get notified when I publish new posts about development, computer science, and technology.
          </p>
          
          <form class="flex flex-col sm:flex-row gap-3 max-w-md mx-auto">
            <input 
              type="email" 
              placeholder="Email address" 
              class="flex-1 bg-slate-800/60 backdrop-blur-sm border border-slate-600/50 text-white placeholder:text-gray-400 rounded-md px-4 py-3 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all duration-200"
              required
            />
            <button 
              type="submit"
              class="bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 px-6 rounded-md transition-all duration-200 hover:scale-105"
            >
              Sign up
            </button>
          </form>
        </div>
      </section>

      
    </div>
  </section>
</Layout>
