---
import { getCollection } from 'astro:content';
import Layout from '../layouts/Layout.astro';
import BlogCard from '../components/BlogCard.astro';

// Get all blog posts that aren't drafts and sort by date (with newest first)
const allPosts = await getCollection('blog', ({ data }) => {
	return data.draft !== true;
});

const sortedPosts = allPosts.sort((a, b) => {
	return b.data.pubDate.getTime() - a.data.pubDate.getTime();
});
---

<Layout title="Blog" description="">
	<section id="blog">
		<div class="h-full w-full flex flex-col gap-6">
			<!-- Page Header -->
			<section class="">
				<h1 class="text-4xl font-bold text-text-primary">
					Blog
				</h1>
			</section>

			<div class="flex flex-col gap-6">
				{sortedPosts.map((post) => (
					<a href={`/blog/${post.slug}`} class="block group">
						<BlogCard 
							title={post.data.title}
							description={post.data.description}
							pubDate={post.data.pubDate.toISOString()}
							tags={post.data.tags ?? []}
							category={post.data.category}
						/>
					</a>
				))}
			</div>

      <!-- Newsletter Signup -->
      <section class="mt-8 pt-16 border-t border-border-primary">
        <div class="text-center">
          <h3 class="text-3xl font-bold text-text-primary mb-4">Subscribe to the newsletter</h3>
          <p class="text-text-tertiary mb-8 max-w-md mx-auto">
            Get notified when I publish new posts about development, computer science, and technology.
          </p>
          
          <form class="flex flex-col sm:flex-row gap-3 max-w-md mx-auto">
            <input 
              type="email" 
              placeholder="Email address" 
              class="flex-1 bg-bg-overlay backdrop-blur-sm border border-border-tertiary text-text-primary placeholder:text-text-secondary rounded-md px-4 py-3 focus:ring-2 focus:ring-accent-primary focus:border-accent-primary transition-all duration-200"
              required
            />
            <button 
              type="submit"
              class="bg-accent-secondary hover:bg-accent-hover text-text-primary font-semibold py-3 px-6 rounded-md transition-all duration-200 hover:scale-105"
            >
              Sign up
            </button>
          </form>
        </div>
      </section>

      
    </div>
  </section>
</Layout>
